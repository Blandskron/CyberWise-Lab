#!/usr/bin/env bash
set -euo pipefail
host="${1:-http://127.0.0.1:8000}"

echo "[*] GET /health (si habilitado)"
curl -s -o /dev/null -w "%{http_code}\n" "$host/health" || true

echo "[*] GET /metrics (si habilitado)"
curl -s -o /dev/null -w "%{http_code}\n" "$host/metrics" || true

echo "[*] CRUD b√°sico"
curl -s -X POST "$host/clients" -H "Content-Type: application/json" -d '{"name":"test","email":"t@e.com","notes":"ok"}' | jq . || true
curl -s "$host/clients" | jq length || true

echo "[*] SQLi simple"
curl -s "$host/clients/search?q=%25' OR '1'='1" | jq .results | jq length || true

echo "[*] XSS almacenado (crear y luego render)"
curl -s -X POST "$host/clients" -H "Content-Type: application/json" -d '{"name":"<img src=x onerror=alert(1)>","email":"x@x","notes":"<script>alert(1)</script>"}' | jq . || true
curl -s "$host/clients/render" >/dev/null || true

echo "OK"
